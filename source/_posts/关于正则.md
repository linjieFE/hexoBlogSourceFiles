---
title: 土味正则表达式
date: 2021-07-16 13:12:22
tags:
  - 学习笔记
categories: 学习笔记
---

很久没更新，本着生命不息，学习不止的态度，
趁着大家顶着7月的烈日炎炎出去团建，而我在公司吹着免费空调、喝着吴老板请的星爸爸、摸着鱼……（好了不能再说了，否则要去财务领工资了）的时间打开沉封已久的博客，随便更新点东西
今天不讲新技术，不说新轮子。扒一扒百家通用的基础 `正则`
学习任何语言最好的线上教科书莫过于[官方文档](https://doc.houdunren.com/php/5%20%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F.html#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F)，这里附上链接，大家自行翻阅

## 土味介绍

为什么说`正则`是百家通，如果你接触过某一门后端语言，无论那一种，都会用到正则表示式，前端也不例外， 你会发现它他们语法都差不多，正则就像一个小弟，需要依赖不同宿主的环境。只是不同的语法环境中使用不同的函数调用它就可以了。
所以，你如果从一种语言环境切换到别一个种言环境中使用`正则`，你只需要学习这种语言调用`正则`的函数方法就可以了。

## 正则的应用场景

最多的应用场景 就是字符串的`增删改查`,可能这里有人会说，前端不是已经有很多处理一些字符串的方法了吗？说的没错，但`正则`的方式要更强悍些。这种感觉就好像过去的`老人机`与`智能机`的对比。
话不闲扯，开始上干货……
#### 举个🌰
🌰1：从一堆字符串中全局找数字
```js
var str ='linjie20210716';
// 传统方式
let nums = [...str].filter(a=> !Number.isNaN(parsesInt(a))).join('')

// 正则匹配 
str.match(/\d/g).join('');
```

## 还有好多好多的 🌰

#### 🌰1：字面量。比如：现在我们让正则在一堆字符串里找`小姐姐`

```js
var str ='xiaojiejie20210716';
console.log(/xiaojiejie/.test(str)) // => true

// 这里 小姐姐 要是个字符串字面量，如果我们现在把 小姐姐 放在 变量里 返回的就是 false
var reg='xiaojiejie';
console.log(/reg/.test(str)) // => false

// 如果你一起想要用变量的形式 也有其它可以支持的方式，第一种就是 eval() ，🌰2：会绍第二种 

console.log(eval(`/${reg}/`).test(str)) //=> true 

```

####  🌰2：用对象创建正则表达式

```js

var str ='xiaojiejie20210716xiaojiejie';
let reg = new RegExp('xiaojiejie','g') //g => 代指全局 
reg.test(str)
//这里的小姐姐也可以用变量代替 结果是一样的
let found = 'xiaojiejie'
let reg = new RegExp(found,'g')

// 现在我们找出所有的小姐姐，进行替换

str.replace(reg, search => {
    return '小姐姐';
}) // => 小姐姐20210716小姐姐 

```


#### 选择符 `|` 类似于 js语法中的`或` `||`
🌰3：这里判断一个电话号码是不是北京或上海的

```js
var str ='010-12345678';
/^(010|021)\-\d{7-8}$/.test(str) //=> 出现任意一种则返回 true 
//
```

***土味语义:`^`代指开始， `$`表示结束，是边界的限定， 010或021 为了简洁这里用`()` 学名`原子组`的东西括起来，`-`和`d`在正则有特殊意义故需要用`\`转义，{7-8}属于`区间匹配` 代表数字7到8位`***

有人说🙋‍♀️ ：那如果我们匹配很多数字的时候不是很麻烦，不是要`(1|2|3|4|5|6|7|8|9|0)`，

这里就要提到正则的一个概念叫 `原子表` `[]` 代表一个可选范围

[1234567890] 相当于 (1|2|3|4|5|6|7|8|9|0)
 
继续简化 `-` 中线符 指定范围区间
[0-9] 就相当于[0123456789]
同样的区别匹配还有`[a-z][A-Z]`,要注意的是这里顺序不像`模式参数/gi`,它不可颠倒成`[z-a][9-0]`

区分：
```js
'xiaojiejie'.match(/ie/g);//=>["ie", "ie"]全量匹配ji为整体
'xiaojiejie'.match(/[ie]/g);//=>["i", "i", "e", "i", "e"]放在原子表里时,相当于j或i 

```
即然提到`原子组`也顺带讲下`原子组`
🌰如：我们现在匹配一日期 中间可以是"-"中线，也可以是"/"，前提条件是前后一至，若前一个用中线，后面必须也是中间。不可以是`2021-07/16`

```js
var date = "2021-07-16"
let reg = /^\d{4}([-\/])\d{2}\1\d{2}$/
console.log(date.match(reg));//=>{true}
```
***土味语义: 关建节点在`([-\/])`原子组 代表包含  了"-“中线`或`”/“两种形式，由于其中/是特殊字面量，需用'\'转义,\1代表这里要求与第一个原子组的规则结果相同***

🌰现在我们来实现一个需求：

**将下面代码中的h1-h6 内容全部替换成空字符 **

```js
    var str='<div><h1>linjie.fe.com xiaojiejie</h1><h2>xiaojiejie2</h2><h3>xiaojiejie3</h3><H4></H4><h6>xiaojiejie666</h6></div>'
    
    var reg = /<(h[1-6])>[\s\S]*<\/\1>/gis;
    
    str.replace(reg,'')//=><div></div>;

```

***土味语义: 以 `<`开始 `(h[1-6])` 原子组中代只h1-h6 `[\s\S]*`表示空白加非空白所有字符 零个至多个字符 `<\/\1>` 代表 `</h1>-</h6>` `/\1` 代表与第一个原子组规则相同 :***

### 🌰4：特殊字面量的转义

🌰4： 这里假设用正则匹配一个url地址

```js
var url = 'https://linjieFE.github.io';

/^(https:\/\/)?\w+\.\w+\.\w+$/.test(url)
```
***土味语义:`^ $`开始结束边界的限定， `?`代码0或1次术语上又属于一种称为`禁止贪婪`的语法，`禁止贪婪`有趋向于最少数的性质，后面我会再次讲到。也可理解为`没有`或`有的时候只能有一个`(https://) `\w`代表 字母大小写数字下划线 相当于 `[A-Za-z0-9_]`  `+` 学名也叫 `贪婪匹配`代表一个或多个字母大小写数字下划线 ***

*注意*
上面的字面量内容如果放在`正则表达式对象`里 情况则不同
字面量`/^(https:\/\/)?\w+\.\w+\.\w+$/`，单个反斜杠会自行转义

但如果在 `new RegExp("(https:\/\/)?\w+\.\w+\.\w+,'g')`中，于由第一个参数本身为数符串，正常使用则要改为`new RegExp("(https:\\/\\/)?\\w+\\.\\w+\\.\\w+",'g')`

### 🌰5： 字符边界的约束 `^$[]{}`
这个前面已代过了 直接到🌰6

### 🌰6： 数字空白元字符 `\s`匹配空白包括 相当于 `[\n\f\r\t\v]`


```js
var url = '     小姐姐:021-1234556,  linjie:010-1234556 ';

url.match(/[-\d:,]+/g);//=> :021-1234556,:010-1234556 全局匹配出一个或多个 中线、数字、冒号、逗号
url.match(/[^-\d:,]+/g); // =>小姐姐linjie 
```

`^` 在 [] `原子表`里面 代表取返`[^]`，术语称其为`排除匹配`, 这里要特别注意跟 `区间符`中的'开始'`^`区分开.

***`排除匹配`土味语义: 全局匹配出一个或多个 `除` 中线、数字、冒号、逗号 的字符***

- 另需注意
    - 当原子组和原子表中使用特殊符号时没有换算关系，仅代表其中的字符本义，（所以转不转义也无妨）举例：
```js
'(xiaojiejie).+'.match(/[()]/g);//=>["(", ")"] 这里 “原子表" 里包括了个“ 原子组” 实际上，原子表代表的只有字符串括号

'(xiaojiejie).+'.match(/[.+]/g);//=>[".", "+"] 

```

### 🌰7：在元字符里除了`^`,还有另一种特殊取反的方式 

P如：
\d 代表数字 \D 代表 除数字
\w 代表数字字母下划线 \W 代表 除代表数字字母下划线
相同的还有 \s \S 等等...
`\s`代三空格、换行、等同与[\n\r]

如：我们匹配一个电话号码 
```js
'010 - 1234567'.match(/^\d+\s?\-\s?\d{7,8}$/);
```
***土味语义: `\d+` 贪婪匹配一个或多个数字 `\s?``有一个`或`没有`空字符 ,`\-`中线 最后`\d{7-8}` 精准匹配7-8位数字 `$`结束***


 `.` 贪婪的点 代表除 `换行符`以外所有的字符

### 🌰7 更加贪婪的全字符
我们知道 哪怕最贪婪的`.`也排除了一个换行符

如：我们想匹配一段代码标签内的所有内容
可以用双向取反的方式 例如：`[\s\S] [\w\W] `
```js
var str =`<span>
    <b>xiaojiejie1</b>
    <em>xiaojiejie2</em>
</span>`;

str.match(/^<span>[\d\D]+<\/span>$/);
```
### 🌰8 正则的修正符`i` `g` 's'

修正符一般用在正则表达示的结尾
如:我们匹配xiaoJiejie中的`j`
```js
'xiaoJiejie'.match(/j/gi);//=>Jj
```
***土味语义: `/gi` 这里结尾中的`i`带代不分大小写，`g`代表全局 否则这里只会匹配一个就会跳出，这里`/gi` 同样可以写成 `/ig`***
*** `/s` 是忽略换行符 当文档出来换行符时，将其看作一行 ***

### 🌰9 多行匹配

业务要求:将str中包含在`#`号中的数据过滤为
`[{name:'成都小姐姐',age:'18'}]`数组对象格式


```js
// step1
var str = `    #1 上海小姐姐,18  #
#2 成都小姐姐,19  #
#3 北京小姐姐,20  # xiaojiejie
#4 杭州小姐姐,21  #
`

var step1 = str.match(/^\s*#\d+\s+.+\s+#$/gms);//=> ["#1 上海小姐姐,18  #", "#2 成都小姐姐,19  #", "#4 杭州小姐姐,21  #"]

//step2 替换掉 #号和井号后的数字

step2 = step1.map(v =>{
    v=v.replace(/^\s*#\d+\s*/,"").replace(/\s#$/,"");//=>上海小姐姐,18  成都小姐姐,19  杭州小姐姐,21 

    //step3 用逗号拆分 解构给'name','age'这个变量
    console.log(v.split(',')) //=> ['上海小姐姐','18']  ['成都小姐姐','19']  ['杭州小姐姐','21' ]

    //解构
    const [name, age] = v.split(',');
    return {name, age}
})


```

***土味语义step1: `/gm` 这里结尾中的`m`代表每一行分别处理，`\s*` 开始空白符`有`或`没有`都可，这里有有泛指 1 个到多个，`#`号 `\d+`一个或多个数字，`\s+` 一个或多个空白符 `.+`除换行符所有字符 `\s+` 一个或多个空白符 `#`号结束***

***土味语义step2: 先把开头部分替换，空白符 1 个到多个，`#`号 `\d+`一个或多个数字，`\s*`零个或多个空白符 替换为空字符串；再将结尾部分空折符到#号结属部分替换为空字符串***
 后面的步骤不用多讲了，就是简单的解构 return对象

### 🌰10 字符属性 汉字 和 宽字节

在正则里字符串有自己的属性值prototype，比如`{L}`代表着字母属性

```js
'xjj1'.match(/\p{L}/gu)//=>["x", "j", "j"]

// 匹配符号

'xjj1.'.match(/\p{P}/gu)//=>['.']


// 匹配汉语

'小姐姐xjj1.'.match(/\p{sc=Han}/gu)//=>["小", "姐", "姐"]

```

***土味语义: `\p` 代码匹配属性是否为字母`{L}` ,`/gu` 全局 *这里注意*匹配属性必段要带`/u` ，带特别是用来试别`宽字节`时, 例如匹配一些罗码字符时***

### 🌰10 lastindex
### 🌰11 有效率的/y模式

### 🌰12 `&'`和  `$&`
$& 相于于字符串 自身

```js

var str='xiaojiejie';
str.replace(/jiejie/g,"$&");//=>"xiaojiejie"
```

### 🌰13 断言匹配

 敲码不易，请多多赞赏！